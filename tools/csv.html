<style>
    .tool-wrapper { background: var(--bg-card); border-radius: 16px; padding: 24px; border: 1px solid var(--border); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
    .tool-header { margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
    .tool-header h3 { margin: 0; color: var(--primary); font-size: 20px; }
    .tool-header p { margin: 5px 0 0; color: var(--text-muted); font-size: 13px; }

    .upload-zone {
        border: 2px dashed var(--border);
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        background: var(--bg-site);
        transition: 0.3s;
        cursor: pointer;
        margin-bottom: 20px;
    }

    .upload-zone:hover { border-color: var(--accent); background: #eff6ff; }
    .upload-zone i { font-size: 30px; display: block; margin-bottom: 10px; }

    .options-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
    }

    .option-card {
        padding: 15px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        font-weight: 500;
    }

    .option-card input { width: 18px; height: 18px; cursor: pointer; }

    .status-box {
        padding: 15px;
        border-radius: 8px;
        background: #f1f5f9;
        font-size: 12px;
        display: none;
        margin-top: 10px;
    }

    .primary-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 16px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; }
    .primary-btn:disabled { background: var(--border); cursor: not-allowed; }
</style>

<div class="tool-wrapper">
    <div class="tool-header">
        <h3>CSV Flow | Data Sanitizer</h3>
        <p>Repair broken CSV files, fix delimiters, and clean spreadsheet data for import.</p>
    </div>

    <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
        <i>üìÑ</i>
        <span id="file-label">Click to upload or drag CSV file here</span>
        <input type="file" id="fileInput" accept=".csv" style="display:none" onchange="handleFile()">
    </div>

    <div class="options-grid">
        <div class="option-card">
            <input type="checkbox" id="trimSpace" checked>
            <label for="trimSpace">Trim White Space</label>
        </div>
        <div class="option-card">
            <input type="checkbox" id="removeEmpty" checked>
            <label for="removeEmpty">Remove Empty Rows</label>
        </div>
        <div class="option-card">
            <input type="checkbox" id="fixQuotes" checked>
            <label for="fixQuotes">Repair Quote-Escaping</label>
        </div>
        <div class="option-card">
            <input type="checkbox" id="toLower">
            <label for="toLower">Standardize to Lowercase</label>
        </div>
    </div>

    <button class="primary-btn" id="procBtn" disabled onclick="processCSV()">üöÄ Sanitize & Download</button>

    <div id="statusBox" class="status-box"></div>
</div>

<script>
    let rawContent = "";
    let fileName = "sanitized_data.csv";

    function handleFile() {
        const file = document.getElementById('fileInput').files[0];
        if (file) {
            fileName = "clean_" + file.name;
            document.getElementById('file-label').innerText = file.name;
            const reader = new FileReader();
            reader.onload = (e) => {
                rawContent = e.target.result;
                document.getElementById('procBtn').disabled = false;
            };
            reader.readAsText(file);
        }
    }

    function processCSV() {
        let lines = rawContent.split(/\r?\n/);
        let cleanedLines = [];

        lines.forEach(line => {
            if (document.getElementById('removeEmpty').checked && !line.trim()) return;
            
            let processedLine = line;
            if (document.getElementById('trimSpace').checked) {
                processedLine = processedLine.split(',').map(cell => cell.trim()).join(',');
            }
            if (document.getElementById('toLower').checked) {
                processedLine = processedLine.toLowerCase();
            }
            // Simple quote repair logic
            if (document.getElementById('fixQuotes').checked) {
                processedLine = processedLine.replace(/[‚Äú‚Äù]/g, '"'); 
            }

            cleanedLines.push(processedLine);
        });

        const blob = new Blob([cleanedLines.join('\n')], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        a.click();

        const status = document.getElementById('statusBox');
        status.style.display = 'block';
        status.innerHTML = `‚úÖ <b>Success:</b> ${cleanedLines.length} rows processed and ready for download.`;
    }
</script>
